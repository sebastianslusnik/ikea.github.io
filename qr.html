<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Code Scanner</title>
  <link rel="stylesheet" href="qr.css?v=1.0.159">
</head>
<body>
  <div class="container" align="center">
    <video id="preview" autoplay playsinline></video><br>
    <button id="starter" onclick="start();">START SCANNING</button>
    <button id="stopper" onclick="stop();" style="display: none;">STOP SCANNING</button>
    <span id="result">...</span>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
  <script>
  document.getElementById("result").innerHTML = "newer";
    let scanner = new Instascan.Scanner({ video: document.getElementById('preview'), mirror: false });
    scanner.addListener('scan', function (content) {
      document.getElementById("result").innerHTML = content;
      document.getElementById("preview").style.borderColor = "forestgreen";
    });

    function start() {
      Instascan.Camera.getCameras().then(function (cameras) {
        if (cameras.length > 0) {
          // List all available cameras
          cameras.forEach((camera, index) => {
            console.log(`Camera ${index}: ${camera.id}, Name: ${camera.name}`);
          });

          // Attempt to select a rear camera or fallback to the first available camera
          let selectedCamera = cameras.find(camera => (/back|rear|environment/i.test(camera.name))) || cameras[0];

          // Try to start the scanner with the selected camera
          scanner.start(selectedCamera).then(() => {
            console.log(`Started scanning with camera: ${selectedCamera.name}`);
          }).catch(function (e) {
            console.error(e);
          });
        } else {
          console.error('No cameras found.');
        }
        document.getElementById("starter").style.display = "none";
        document.getElementById("stopper").style.display = "block";
      }).catch(function (e) {
        console.error(e);
      });
    }

    function stop() {
      scanner.stop().then(() => {
        console.log('Scanner stopped');
        document.getElementById("stopper").style.display = "none";
        document.getElementById("starter").style.display = "block";
      }).catch(function (e) {
        console.error('Error stopping scanner:', e);
      });
    }
  </script>
</body>
</html>
